<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Hierarchical Product Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-container {
            padding: 30px;
        }

        .search-step {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .search-step.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .search-step.completed {
            border-color: #28a745;
            background: #f8fff9;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-number.completed {
            background: #28a745;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .search-button:hover {
            background: #5a6fd8;
        }

        .search-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .results-container {
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .result-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-card.selected {
            border-color: #28a745;
            background: #f8fff9;
        }

        .result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .result-code {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .result-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-featured {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .selected-items {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .selected-item {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            margin: 5px;
            font-size: 0.9rem;
        }

        .clear-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .clear-button:hover {
            background: #c82333;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e1e5e9;
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Product-specific styles */
        .product-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .product-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .product-sku {
            color: #666;
            font-size: 0.9rem;
            font-family: monospace;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: #28a745;
            margin-bottom: 5px;
        }

        .product-mrp {
            color: #666;
            font-size: 0.9rem;
            text-decoration: line-through;
            margin-bottom: 10px;
        }

        .product-stock {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stock-available {
            color: #28a745;
        }

        .stock-out {
            color: #dc3545;
        }

        .product-status {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-live {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination button:hover:not(:disabled) {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .current-page {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-container {
                padding: 20px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç Complete Product Search</h1>
            <p>Step-by-step product discovery with filtering</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 25%"></div>
        </div>

        <!-- Search Container -->
        <div class="search-container">
            <!-- Step 1: Brand Search -->
            <div class="search-step active" id="brandStep">
                <div class="step-header">
                    <div class="step-number" id="brandStepNumber">1</div>
                    <div class="step-title">Search Brand</div>
                </div>
                <input type="text" class="search-input" id="brandInput" placeholder="Enter brand name (e.g., Maruti, Suzuki, TVS)">
                <button class="search-button" onclick="searchBrands()">Search Brands</button>
                <div class="results-container" id="brandResults"></div>
            </div>

            <!-- Step 2: Model Search -->
            <div class="search-step" id="modelStep">
                <div class="step-header">
                    <div class="step-number" id="modelStepNumber">2</div>
                    <div class="step-title">Search Model</div>
                </div>
                <input type="text" class="search-input" id="modelInput" placeholder="Enter model name" disabled>
                <button class="search-button" onclick="searchModels()" disabled id="modelSearchBtn">Search Models</button>
                <div class="results-container" id="modelResults"></div>
            </div>

            <!-- Step 3: Variant Search -->
            <div class="search-step" id="variantStep">
                <div class="step-header">
                    <div class="step-number" id="variantStepNumber">3</div>
                    <div class="step-title">Search Variant</div>
                </div>
                <input type="text" class="search-input" id="variantInput" placeholder="Enter variant name" disabled>
                <button class="search-button" onclick="searchVariants()" disabled id="variantSearchBtn">Search Variants</button>
                <div class="results-container" id="variantResults"></div>
            </div>

            <!-- Step 4: Product Search -->
            <div class="search-step" id="productStep">
                <div class="step-header">
                    <div class="step-number" id="productStepNumber">4</div>
                    <div class="step-title">Search Products</div>
                </div>
                <input type="text" class="search-input" id="productInput" placeholder="Enter product name or SKU (optional)" disabled>
                <button class="search-button" onclick="searchProducts()" disabled id="productSearchBtn">Search Products</button>
                <div class="results-container" id="productResults"></div>
            </div>

            <!-- Selected Items -->
            <div class="selected-items" id="selectedItems" style="display: none;">
                <h3>Selected Filters:</h3>
                <div id="selectedList"></div>
                <button class="clear-button" onclick="clearSelection()">Clear Selection</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:5002';
        const ENDPOINT = '/products/v1/hierarchical-search';
        
        // State
        let selectedBrand = null;
        let selectedModel = null;
        let selectedVariant = null;
        let currentPage = 1;
        let totalPages = 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // Brand input
            document.getElementById('brandInput').addEventListener('input', function() {
                if (this.value.length >= 2) {
                    searchBrands();
                }
            });

            // Model input
            document.getElementById('modelInput').addEventListener('input', function() {
                if (this.value.length >= 2) {
                    searchModels();
                }
            });

            // Variant input
            document.getElementById('variantInput').addEventListener('input', function() {
                if (this.value.length >= 2) {
                    searchVariants();
                }
            });

            // Product input
            document.getElementById('productInput').addEventListener('input', function() {
                if (this.value.length >= 2 || this.value.length === 0) {
                    searchProducts();
                }
            });
        }

        async function searchBrands() {
            const query = document.getElementById('brandInput').value.trim();
            if (query.length < 2) return;

            try {
                showLoading('brandResults');
                
                const response = await fetch(`${API_BASE_URL}${ENDPOINT}?query=${encodeURIComponent(query)}&type=brand&limit=10`, {
                    headers: {
                        'Authorization': 'Bearer your-auth-token-here', // Replace with actual token
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    displayBrandResults(data.data.results);
                } else {
                    showError('brandResults', 'Failed to search brands: ' + data.message);
                }
            } catch (error) {
                console.error('Brand search error:', error);
                showError('brandResults', 'Error searching brands: ' + error.message);
            }
        }

        async function searchModels() {
            if (!selectedBrand) return;
            
            const query = document.getElementById('modelInput').value.trim();
            if (query.length < 2) return;

            try {
                showLoading('modelResults');
                
                const response = await fetch(`${API_BASE_URL}${ENDPOINT}?query=${encodeURIComponent(query)}&type=model&brandId=${selectedBrand.id}&limit=10`, {
                    headers: {
                        'Authorization': 'Bearer your-auth-token-here', // Replace with actual token
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    displayModelResults(data.data.results);
                } else {
                    showError('modelResults', 'Failed to search models: ' + data.message);
                }
            } catch (error) {
                console.error('Model search error:', error);
                showError('modelResults', 'Error searching models: ' + error.message);
            }
        }

        async function searchVariants() {
            if (!selectedModel) return;
            
            const query = document.getElementById('variantInput').value.trim();
            if (query.length < 2) return;

            try {
                showLoading('variantResults');
                
                const response = await fetch(`${API_BASE_URL}${ENDPOINT}?query=${encodeURIComponent(query)}&type=variant&modelId=${selectedModel.id}&limit=10`, {
                    headers: {
                        'Authorization': 'Bearer your-auth-token-here', // Replace with actual token
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    displayVariantResults(data.data.results);
                } else {
                    showError('variantResults', 'Failed to search variants: ' + data.message);
                }
            } catch (error) {
                console.error('Variant search error:', error);
                showError('variantResults', 'Error searching variants: ' + error.message);
            }
        }

        async function searchProducts() {
            if (!selectedBrand) return;
            
            const query = document.getElementById('productInput').value.trim();
            
            try {
                showLoading('productResults');
                
                let url = `${API_BASE_URL}${ENDPOINT}?type=products&brandId=${selectedBrand.id}&limit=10&page=${currentPage}`;
                
                if (selectedModel) {
                    url += `&modelId=${selectedModel.id}`;
                }
                
                if (selectedVariant) {
                    url += `&variantId=${selectedVariant.id}`;
                }
                
                if (query) {
                    url += `&query=${encodeURIComponent(query)}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': 'Bearer your-auth-token-here', // Replace with actual token
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    displayProductResults(data.data.results, data.data.pagination);
                } else {
                    showError('productResults', 'Failed to search products: ' + data.message);
                }
            } catch (error) {
                console.error('Product search error:', error);
                showError('productResults', 'Error searching products: ' + error.message);
            }
        }

        function displayBrandResults(brands) {
            const container = document.getElementById('brandResults');
            
            if (brands.length === 0) {
                container.innerHTML = '<div class="no-results">No brands found</div>';
                return;
            }

            const html = `
                <div class="results-grid">
                    ${brands.map(brand => `
                        <div class="result-card" onclick="selectBrand('${brand.id}', '${brand.name}', '${brand.code}')">
                            <div class="result-name">${brand.name}</div>
                            <div class="result-code">Code: ${brand.code}</div>
                            ${brand.featured ? '<div class="result-status status-featured">Featured</div>' : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displayModelResults(models) {
            const container = document.getElementById('modelResults');
            
            if (models.length === 0) {
                container.innerHTML = '<div class="no-results">No models found</div>';
                return;
            }

            const html = `
                <div class="results-grid">
                    ${models.map(model => `
                        <div class="result-card" onclick="selectModel('${model.id}', '${model.name}', '${model.code}')">
                            <div class="result-name">${model.name}</div>
                            <div class="result-code">Code: ${model.code}</div>
                            <div class="result-status status-active">${model.status}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displayVariantResults(variants) {
            const container = document.getElementById('variantResults');
            
            if (variants.length === 0) {
                container.innerHTML = '<div class="no-results">No variants found</div>';
                return;
            }

            const html = `
                <div class="results-grid">
                    ${variants.map(variant => `
                        <div class="result-card" onclick="selectVariant('${variant.id}', '${variant.name}', '${variant.code}')">
                            <div class="result-name">${variant.name}</div>
                            <div class="result-code">Code: ${variant.code}</div>
                            <div class="result-status status-active">${variant.status}</div>
                            ${variant.description ? `<div style="font-size: 0.8rem; color: #666; margin-top: 5px;">${variant.description}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displayProductResults(products, pagination) {
            const container = document.getElementById('productResults');
            
            if (products.length === 0) {
                container.innerHTML = '<div class="no-results">No products found</div>';
                return;
            }

            totalPages = pagination.totalPages;
            currentPage = pagination.currentPage;

            const html = `
                <div style="margin-bottom: 15px;">
                    <strong>Found ${pagination.totalItems} products</strong>
                    ${pagination.totalPages > 1 ? ` (Page ${pagination.currentPage} of ${pagination.totalPages})` : ''}
                </div>
                <div class="results-grid">
                    ${products.map(product => `
                        <div class="product-card">
                            <div class="product-name">${product.product_name}</div>
                            <div class="product-sku">SKU: ${product.sku_code}</div>
                            <div class="product-price">‚Çπ${product.pricing.selling_price}</div>
                            <div class="product-mrp">MRP: ‚Çπ${product.pricing.mrp_with_gst}</div>
                            <div class="product-stock ${product.stock.out_of_stock ? 'stock-out' : 'stock-available'}">
                                Stock: ${product.stock.no_of_stock} units
                            </div>
                            <div class="product-status">
                                <div class="status-badge status-${product.status.live_status.toLowerCase()}">${product.status.live_status}</div>
                                <div class="status-badge status-${product.status.qc_status.toLowerCase()}">${product.status.qc_status}</div>
                            </div>
                            ${product.brand ? `<div style="font-size: 0.9rem; color: #666;">Brand: ${product.brand.name}</div>` : ''}
                            ${product.model ? `<div style="font-size: 0.9rem; color: #666;">Model: ${product.model.name}</div>` : ''}
                            ${product.variants.length > 0 ? `<div style="font-size: 0.9rem; color: #666;">Variants: ${product.variants.map(v => v.name).join(', ')}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ${pagination.totalPages > 1 ? `
                    <div class="pagination">
                        <button onclick="changePage(1)" ${pagination.currentPage === 1 ? 'disabled' : ''}>First</button>
                        <button onclick="changePage(${pagination.currentPage - 1})" ${!pagination.hasPreviousPage ? 'disabled' : ''}>Previous</button>
                        <span class="current-page">${pagination.currentPage}</span>
                        <button onclick="changePage(${pagination.currentPage + 1})" ${!pagination.hasNextPage ? 'disabled' : ''}>Next</button>
                        <button onclick="changePage(${pagination.totalPages})" ${pagination.currentPage === pagination.totalPages ? 'disabled' : ''}>Last</button>
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = html;
        }

        function selectBrand(id, name, code) {
            selectedBrand = { id, name, code };
            
            // Update UI
            document.getElementById('brandStep').classList.add('completed');
            document.getElementById('brandStepNumber').classList.add('completed');
            document.getElementById('modelStep').classList.add('active');
            document.getElementById('modelInput').disabled = false;
            document.getElementById('modelSearchBtn').disabled = false;
            
            // Update progress
            document.getElementById('progressFill').style.width = '50%';
            
            // Clear subsequent selections
            selectedModel = null;
            selectedVariant = null;
            document.getElementById('modelResults').innerHTML = '';
            document.getElementById('variantResults').innerHTML = '';
            document.getElementById('productResults').innerHTML = '';
            document.getElementById('variantStep').classList.remove('active', 'completed');
            document.getElementById('productStep').classList.remove('active', 'completed');
            document.getElementById('variantInput').disabled = true;
            document.getElementById('productInput').disabled = true;
            document.getElementById('variantSearchBtn').disabled = true;
            document.getElementById('productSearchBtn').disabled = true;
            
            updateSelectedItems();
        }

        function selectModel(id, name, code) {
            selectedModel = { id, name, code };
            
            // Update UI
            document.getElementById('modelStep').classList.add('completed');
            document.getElementById('modelStepNumber').classList.add('completed');
            document.getElementById('variantStep').classList.add('active');
            document.getElementById('variantInput').disabled = false;
            document.getElementById('variantSearchBtn').disabled = false;
            
            // Update progress
            document.getElementById('progressFill').style.width = '75%';
            
            // Clear subsequent selections
            selectedVariant = null;
            document.getElementById('variantResults').innerHTML = '';
            document.getElementById('productResults').innerHTML = '';
            document.getElementById('productStep').classList.remove('active', 'completed');
            document.getElementById('productInput').disabled = true;
            document.getElementById('productSearchBtn').disabled = true;
            
            updateSelectedItems();
        }

        function selectVariant(id, name, code) {
            selectedVariant = { id, name, code };
            
            // Update UI
            document.getElementById('variantStep').classList.add('completed');
            document.getElementById('variantStepNumber').classList.add('completed');
            document.getElementById('productStep').classList.add('active');
            document.getElementById('productInput').disabled = false;
            document.getElementById('productSearchBtn').disabled = false;
            
            // Update progress
            document.getElementById('progressFill').style.width = '100%';
            
            // Clear product results
            document.getElementById('productResults').innerHTML = '';
            
            updateSelectedItems();
            
            // Auto-search products when variant is selected
            searchProducts();
        }

        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                searchProducts();
            }
        }

        function updateSelectedItems() {
            const selectedItems = document.getElementById('selectedItems');
            const selectedList = document.getElementById('selectedList');
            
            if (selectedBrand || selectedModel || selectedVariant) {
                selectedItems.style.display = 'block';
                
                let items = [];
                if (selectedBrand) items.push(`Brand: ${selectedBrand.name}`);
                if (selectedModel) items.push(`Model: ${selectedModel.name}`);
                if (selectedVariant) items.push(`Variant: ${selectedVariant.name}`);
                
                selectedList.innerHTML = items.map(item => `<div class="selected-item">${item}</div>`).join('');
            } else {
                selectedItems.style.display = 'none';
            }
        }

        function clearSelection() {
            selectedBrand = null;
            selectedModel = null;
            selectedVariant = null;
            currentPage = 1;
            
            // Reset UI
            document.getElementById('brandStep').classList.remove('completed');
            document.getElementById('modelStep').classList.remove('active', 'completed');
            document.getElementById('variantStep').classList.remove('active', 'completed');
            document.getElementById('productStep').classList.remove('active', 'completed');
            
            document.getElementById('brandStepNumber').classList.remove('completed');
            document.getElementById('modelStepNumber').classList.remove('completed');
            document.getElementById('variantStepNumber').classList.remove('completed');
            document.getElementById('productStepNumber').classList.remove('completed');
            
            document.getElementById('modelInput').disabled = true;
            document.getElementById('variantInput').disabled = true;
            document.getElementById('productInput').disabled = true;
            document.getElementById('modelSearchBtn').disabled = true;
            document.getElementById('variantSearchBtn').disabled = true;
            document.getElementById('productSearchBtn').disabled = true;
            
            document.getElementById('brandResults').innerHTML = '';
            document.getElementById('modelResults').innerHTML = '';
            document.getElementById('variantResults').innerHTML = '';
            document.getElementById('productResults').innerHTML = '';
            
            document.getElementById('progressFill').style.width = '25%';
            
            updateSelectedItems();
        }

        function showLoading(containerId) {
            document.getElementById(containerId).innerHTML = '<div class="loading">Searching...</div>';
        }

        function showError(containerId, message) {
            document.getElementById(containerId).innerHTML = `<div class="no-results">${message}</div>`;
        }
    </script>
</body>
</html>
